<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vulnerability Comparator (CVSS vs. EPSS)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Optional: Custom Tailwind theme settings
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand-cyan': '#06b6d4',
                        'dark-bg': '#0f172a',
                        'dark-card': '#1e293b',
                        'dark-border': '#334155',
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-gray-950 text-white min-h-screen flex flex-col">
        <!-- Navigation Bar -->
            <nav class="bg-gray-900 border-b border-gray-800 sticky top-0 z-30 mb-4">
                <div class="max-w-5xl mx-auto flex items-center justify-between px-4 py-3">
                    <div class="flex items-center space-x-3">
                        <a href="https://www.linkedin.com/in/chandler-prince-b53b1427/" target="_blank" rel="noopener" class="text-blue-400 hover:text-blue-300" title="LinkedIn"><span id="nav-linkedin" class="w-6 h-6"></span></a>
                        <a href="https://github.com/DChandlerP/" target="_blank" rel="noopener" class="text-blue-400 hover:text-blue-300" title="GitHub"><span id="nav-github" class="w-6 h-6"></span></a>
                    </div>
                     <div class="flex space-x-2">
                        <a href="index.html" class="flex items-center px-3 py-1 rounded text-blue-300 hover:bg-gray-800 hover:text-white font-semibold transition"><span id="nav-home" class="mr-1"></span>Home</a>
                        <a href="jwt.html" class="flex items-center px-3 py-1 rounded text-blue-300 hover:bg-gray-800 hover:text-white font-semibold transition"><span id="nav-jwt" class="mr-1"></span>JWT Decoder</a>
                        <a href="fingerprint.html" class="flex items-center px-3 py-1 rounded text-blue-300 hover:bg-gray-800 hover:text-white font-semibold transition"><span id="nav-fp" class="mr-1"></span>Fingerprint Demo</a>
                        <a href="epssdemo.html" class="flex items-center px-3 py-1 rounded text-blue-300 hover:bg-gray-800 hover:text-white font-semibold transition"><span id="nav-epss" class="mr-1"></span>EPSS Comparator</a>
                        <a href="modcat.html" class="flex items-center px-3 py-1 rounded text-blue-300 hover:bg-gray-800 hover:text-white font-semibold transition"><span id="nav-modcat" class="mr-1"></span>MODCAT Decoder</a>
                    </div>
                </div>
            </nav>
        <main class="flex-1 px-4 py-10 max-w-5xl mx-auto w-full">
                <header class="text-center mb-10">
                        <h1 class="text-4xl md:text-5xl font-bold text-white mb-2">Vulnerability Comparator</h1>
                        <p class="text-xl text-blue-300">CVSS Severity vs. EPSS Exploitability</p>
                </header>

                <section class="mb-8 grid gap-6 md:grid-cols-2">
                        <div class="bg-gray-900 rounded-xl shadow-lg p-5 border border-gray-800">
                                <h3 class="font-semibold text-lg text-yellow-400 mb-1">What is CVSS?</h3>
                                <p class="text-sm text-gray-300">The <strong>Common Vulnerability Scoring System (CVSS)</strong> rates severity on a scale of 0-10. It answers: "How bad would this be if it were exploited?" It considers impact (Confidentiality, Integrity, Availability) and how easy it is to exploit (Attack Vector, Complexity, etc.).</p>
                        </div>
                        <div class="bg-gray-900 rounded-xl shadow-lg p-5 border border-gray-800">
                                <h3 class="font-semibold text-lg text-blue-400 mb-1">What is EPSS?</h3>
                                <p class="text-sm text-gray-300">The <strong>Exploit Prediction Scoring System (EPSS)</strong> estimates the probability (0-100%) that a vulnerability will be exploited in the wild in the next 30 days. It answers: "How likely is this to be exploited <em>right now</em>?"</p>
                        </div>
                </section>

                <section class="mb-8 flex flex-col sm:flex-row gap-4">
                        <input type="text" id="vulnId" 
                                     class="flex-grow bg-gray-800 text-white border-2 border-gray-700 rounded-lg px-4 py-3 text-lg focus:border-blue-400 focus:ring-0 outline-none transition" 
                                     placeholder="Enter CVE ID (e.g., CVE-2024-3094)" 
                                     value="CVE-2019-1010218">
                        <button id="fetchButton" 
                                        class="bg-blue-700 text-white font-bold px-8 py-3 rounded-lg text-lg hover:bg-blue-600 transition-colors duration-200">
                                Compare Data
                        </button>
                </section>

                <div id="results-container"></div>
        </main>

        <footer class="bg-gray-900 text-gray-400 text-center py-4 mt-8 rounded-t-xl shadow-inner">
            Â© 2025 D. Chandler Prince
        </footer>

        <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
        <script>
            // Render Lucide icons
                    lucide.createIcons({
                            icons: {
                                'nav-home': lucide.Home,
                                'nav-jwt': lucide.KeyRound,
                                'nav-fp': lucide.Fingerprint,
                                'nav-epss': lucide.Activity,
                                'nav-linkedin': lucide.Linkedin,
                                'nav-github': lucide.Github
                            },
                        attrs: {
                            color: "#38bdf8",
                            size: 24,
                            strokeWidth: 2
                        }
                    });
        document.addEventListener('DOMContentLoaded', () => {
            const fetchButton = document.getElementById('fetchButton');
            const vulnIdInput = document.getElementById('vulnId');

            // Attach listener to the button
            fetchButton.addEventListener('click', fetchVulnComparison);
            
            // Also allow pressing Enter in the input field
            vulnIdInput.addEventListener('keyup', (event) => {
                if (event.key === 'Enter') {
                    fetchVulnComparison();
                }
            });

            // 3. Auto-fetch data for the default CVE on page load
            fetchVulnComparison();
        });

        /**
         * Main function to fetch both NVD (CVSS) and EPSS data concurrently.
         */
        async function fetchVulnComparison() {
            const cveId = document.getElementById('vulnId').value.trim();
            const resultsContainer = document.getElementById('results-container');
            
            if (!cveId) {
                resultsContainer.innerHTML = `<p class="text-center text-red-400">Please enter a CVE ID.</p>`;
                return;
            }

            // Show loading state
            resultsContainer.innerHTML = `
                <div class="text-center p-12 bg-dark-card rounded-lg border border-dark-border">
                    <p class="text-2xl animate-pulse">Fetching data for ${cveId}...</p>
                </div>`;

            // Define API endpoints
            const nvdUrl = `https://services.nvd.nist.gov/rest/json/cves/2.0?cveId=${cveId}`;
            const epssUrl = `https://api.first.org/data/v1/epss?cve=${cveId}`;

            try {
                // 4. Use Promise.allSettled to fetch both APIs. 
                // This ensures that even if one fails (e.g., EPSS has no data), the other can still display.
                const [nvdResult, epssResult] = await Promise.allSettled([
                    fetch(nvdUrl).then(res => res.ok ? res.json() : Promise.reject(`NVD API Error: ${res.status} ${res.statusText}`)),
                    fetch(epssUrl).then(res => res.ok ? res.json() : Promise.reject(`EPSS API Error: ${res.status} ${res.statusText}`))
                ]);

                // --- Process Data ---
                let cveDetails = { description: 'No description found.' };
                let cvssData = null;
                let epssData = null;

                // Process NVD/CVSS Result
                if (nvdResult.status === 'fulfilled' && nvdResult.value.vulnerabilities?.length > 0) {
                    const cve = nvdResult.value.vulnerabilities[0].cve;
                    cveDetails.description = cve.descriptions.find(d => d.lang === 'en')?.value || 'No description provided.';
                    
                    const metrics = cve.metrics.cvssMetricV31?.[0];
                    if (metrics) {
                        cvssData = {
                            ...metrics.cvssData, // baseScore, severity, attackVector, etc.
                            exploitabilityScore: metrics.exploitabilityScore,
                            impactScore: metrics.impactScore
                        };
                    }
                }

                // Process EPSS Result
                if (epssResult.status === 'fulfilled' && epssResult.value.data?.length > 0) {
                    epssData = epssResult.value.data[0]; // { cve, epss, percentile, date }
                }

                // Render the combined results
                renderResults(cveId, cveDetails, cvssData, epssData);

            } catch (error) {
                console.error('Fetch error:', error);
                resultsContainer.innerHTML = `<p class="text-center text-red-400">An unexpected error occurred: ${error.message}</p>`;
            }
        }

        /**
         * Renders the complete results UI into the container.
         */
        function renderResults(cveId, cveDetails, cvssData, epssData) {
            const resultsContainer = document.getElementById('results-container');
            // Format the description into key-value pairs if possible
            const descHtml = formatCveDescription(cveDetails.description);
            resultsContainer.innerHTML = `
                <div class="bg-gray-900 rounded-xl shadow-2xl border border-gray-800 overflow-hidden mb-8">
                    <div class="p-6">
                        <h2 class="text-3xl font-bold text-white mb-3">${cveId}</h2>
                        <div class="text-gray-300 mb-6">${descHtml}</div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-px bg-gray-800">
                        ${renderCvssColumn(cvssData)}
                        ${renderEpssColumn(epssData)}
                    </div>
                </div>
            `;
        }

        /**
         * Helper function to generate the HTML for the CVSS column.
         */
        function renderCvssColumn(data) {
            if (!data) {
                return `
                    <div class="bg-dark-card p-6">
                        <h3 class="text-2xl font-semibold text-yellow-400 mb-4">CVSS v3.1 Severity</h3>
                        <p class="text-gray-400">No CVSS v3.1 data found for this CVE.</p>
                    </div>`;
            }

            const { baseScore, baseSeverity, exploitabilityScore, impactScore } = data;
            const { severityClass, severityTextClass } = getSeverityClasses(baseSeverity);

            return `
                <div class="bg-dark-card p-6">
                    <h3 class="text-2xl font-semibold text-yellow-400 mb-4">CVSS v3.1 Severity</h3>
                    
                    <div class="text-center rounded-lg p-6 mb-6 ${severityClass}">
                        <div class="text-sm font-bold uppercase tracking-widest ${severityTextClass} opacity-75">Base Score</div>
                        <div class="text-7xl font-bold ${severityTextClass}">${baseScore.toFixed(1)}</div>
                        <div class="text-3xl font-semibold ${severityTextClass}">${baseSeverity}</div>
                    </div>

                    <h4 class="text-lg font-semibold text-gray-200 mb-3">Metric Details</h4>
                    <ul class="space-y-2">
                        ${renderMetricItem('Exploitability Score', exploitabilityScore)}
                        ${renderMetricItem('Impact Score', impactScore)}
                        <hr class="border-dark-border my-3">
                        ${renderMetricItem('Attack Vector', data.attackVector)}
                        ${renderMetricItem('Attack Complexity', data.attackComplexity)}
                        ${renderMetricItem('Privileges Required', data.privilegesRequired)}
                        ${renderMetricItem('User Interaction', data.userInteraction)}
                        <hr class="border-dark-border my-3">
                        ${renderMetricItem('Confidentiality', data.confidentialityImpact)}
                        ${renderMetricItem('Integrity', data.integrityImpact)}
                        ${renderMetricItem('Availability', data.availabilityImpact)}
                    </ul>
                </div>
            `;
        }

        /**
         * Helper function to generate the HTML for the EPSS column.
         */
        function renderEpssColumn(data) {
            if (!data) {
                return `
                    <div class="bg-dark-card p-6">
                        <h3 class="text-2xl font-semibold text-orange-400 mb-4">EPSS Exploitability</h3>
                        <p class="text-gray-400">No EPSS data found for this CVE.</p>
                    </div>`;
            }

            const { epss, percentile } = data;
            const epssPercent = formatPercent(epss);
            const percentilePercent = formatPercent(percentile);

            return `
                <div class="bg-dark-card p-6">
                    <h3 class="text-2xl font-semibold text-orange-400 mb-4">EPSS Exploitability</h3>
                    
                    <div class="text-center rounded-lg p-6 mb-6 bg-gray-800 border border-dark-border">
                        <div class="text-sm font-bold uppercase tracking-widest text-orange-400 opacity-75">Exploitation Probability</div>
                        <div class="text-7xl font-bold text-orange-400">${epssPercent}</div>
                        <div class="text-2xl font-semibold text-gray-200">in next 30 days</div>
                    </div>

                    <div class="text-center bg-gray-800 rounded-lg p-4 mb-6 border border-dark-border">
                        <div class="text-lg text-gray-200">
                            This vulnerability is more likely to be exploited than
                            <strong class="text-4xl block text-white my-1">${percentilePercent}</strong>
                            of all other known vulnerabilities.
                        </div>
                    </div>
                    
                    <h4 class="text-lg font-semibold text-gray-200 mb-3">Prioritization Insight</h4>
                    <p class="text-gray-300">
                        A high CVSS score (high severity) combined with a high EPSS score (high likelihood) means this vulnerability should be a <strong>top priority</strong> for remediation.
                    </p>
                    <p class="text-gray-300 mt-2">
                        A high CVSS score with a <strong class="text-green-400">low EPSS score</strong> may indicate a vulnerability that is severe, but not actively being exploited, allowing you to prioritize other threats first.
                    </p>
                </div>
            `;
        }

        // --- Utility Helpers ---

        /** Creates a styled list item for vulnerability metrics. */
        function renderMetricItem(label, value) {
            if (!value) return '';
            return `
                <li class="flex justify-between items-center text-sm">
                    <span class="text-gray-400">${label}:</span>
                    <span class="font-bold text-gray-100 bg-gray-700 px-2 py-0.5 rounded">${value}</span>
                </li>
            `;
        }

        /** Formats a float (0.0 to 1.0) into a percentage string (e.g., "12.3%"). */
        function formatPercent(value) {
            const num = parseFloat(value);
            if (isNaN(num)) return 'N/A';
            return (num * 100).toFixed(1) + '%';
        }

        /** Returns Tailwind classes based on CVSS severity. */
        function getSeverityClasses(severity) {
            switch (severity) {
                case 'CRITICAL':
                    return { severityClass: 'bg-red-900 border border-red-700', severityTextClass: 'text-red-300' };
                case 'HIGH':
                    return { severityClass: 'bg-red-800 border border-red-600', severityTextClass: 'text-red-300' };
                case 'MEDIUM':
                    return { severityClass: 'bg-yellow-800 border border-yellow-600', severityTextClass: 'text-yellow-300' };
                case 'LOW':
                    return { severityClass: 'bg-green-800 border border-green-600', severityTextClass: 'text-green-300' };
                default:
                    return { severityClass: 'bg-gray-800 border border-gray-700', severityTextClass: 'text-gray-300' };
            }
        }

        /**
         * Formats a CVE description into a list of key-value pairs if possible, otherwise returns as paragraph.
         * Recognizes patterns like "The component is: ...", "The impact is: ...", etc.
         */
        function formatCveDescription(desc) {
            if (!desc) return '';
            // Try to split on ". " and look for known keys
            const knownKeys = [
                'The component is:',
                'The impact is:',
                'The attack vector is:',
                'The fixed version is:',
                'The vulnerability is:',
                'The cause is:',
                'The version is:',
                'The CWE is:',
                'The CVSS is:'
            ];
            // Always show the first sentence as the summary
            const parts = desc.split(/\.\s+/);
            let html = '';
            if (parts.length > 0) {
                html += `<p class="mb-2">${parts[0].trim()}.</p>`;
            }
            for (let i = 1; i < parts.length; ++i) {
                const p = parts[i].trim();
                const keyMatch = knownKeys.find(k => p.startsWith(k));
                if (keyMatch) {
                    const value = p.substring(keyMatch.length).trim();
                    html += `<div class="mb-1"><span class="font-semibold text-blue-300">${keyMatch.replace(':','')}</span>: <span class="text-gray-100">${value}</span></div>`;
                } else if (p.length > 0) {
                    html += `<div class="mb-1">${p}.</div>`;
                }
            }
            return html;
        }

    </script>
</body>
</html>