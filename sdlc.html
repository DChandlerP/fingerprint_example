<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure SDLC | D. Chandler Prince</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        /* 2. Custom Styles */
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        /* Custom styles for the popover content */
        .popover-content ul {
            list-style-type: disc;
            padding-left: 20px;
            margin-top: 8px;
        }
        .popover-content li {
            margin-bottom: 4px;
        }
        .popover-content strong {
            color: #f0f0f0;
        }
        /* ADDED: Ensure navbar dropdowns appear on top */
        .group .absolute {
          z-index: 50;
        }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <nav class="bg-gray-900 border-b border-gray-800 sticky top-0 z-40">
        <div class="w-full flex items-center justify-center px-6 py-3">
           <!-- Main navigation container -->
           <div class="flex flex-wrap justify-center space-x-4">
            
            <a href="index.html" class="flex items-center px-3 py-1 rounded text-blue-300 hover:bg-gray-800 hover:text-white font-semibold transition">
              <span id="nav-home" class="mr-1"></span>Home
            </a>
  
            <!-- Guides & Case Studies Dropdown -->
            <div class="relative group">
              <!-- Dropdown Trigger -->
              <button class="flex items-center px-3 py-1 rounded text-blue-300 hover:bg-gray-800 hover:text-white font-semibold transition">
                <span id="nav-guides-trigger" class="mr-1"></span>
                Guides & Case Studies
                <span id="nav-guides-chevron" class="ml-1"></span>
              </button>
              
              <!-- Dropdown Menu -->
              <div class="absolute left-0 mt-1 w-56 rounded-md shadow-lg bg-gray-800 ring-1 ring-black ring-opacity-5 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200">
                <div class="py-1" role="menu" aria-orientation="vertical">
                  <a href="regulation.html" class="flex items-center px-4 py-2 text-sm text-blue-200 hover:bg-gray-700 hover:text-white" role="menuitem">
                    <span id="nav-regulation" class="mr-2"></span>Regulation (US/EU)
                  </a>
                  <a href="cloud.html" class="flex items-center px-4 py-2 text-sm text-blue-200 hover:bg-gray-700 hover:text-white" role="menuitem">
                    <span id="nav-cloud" class="mr-2"></span>Cloud
                  </a>
                  <a href="cyber_roadmap.html" class="flex items-center px-4 py-2 text-sm text-blue-200 hover:bg-gray-700 hover:text-white" role="menuitem">
                    <span id="nav-roadmap" class="mr-2"></span>Cyber Roadmap
                  </a>
                  <a href="phishing.html" class="flex items-center px-4 py-2 text-sm text-blue-200 hover:bg-gray-700 hover:text-white" role="menuitem">
                    <span id="nav-phishing" class="mr-2"></span>Phishing
                  </a>
                  <a href="sast.html" class="flex items-center px-4 py-2 text-sm text-blue-200 hover:bg-gray-700 hover:text-white" role="menuitem">
                    <span id="nav-sast" class="mr-2"></span>SAST
                  </a>
                  <a href="threatmodel.html" class="flex items-center px-4 py-2 text-sm text-blue-200 hover:bg-gray-700 hover:text-white" role="menuitem">
                    <span id="nav-threat" class="mr-2"></span>Threat Model
                  </a>
                  <a href="fair.html" class="flex items-center px-4 py-2 text-sm text-blue-200 hover:bg-gray-700 hover:text-white" role="menuitem">
                      <span id="nav-fair" class="mr-2"></span>FAIR Risk Scoring
                  </a>
                  <a href="sdlc.html" class="flex items-center px-4 py-2 text-sm text-blue-200 hover:bg-gray-700 hover:text-white" role="menuitem">
                      <span id="nav-sdlc" class="mr-2"></span>Secure SDLC
                  </a>
                </div>
              </div>
            </div>
  
            <!-- Tools & Demos Dropdown -->
            <div class="relative group">
              <!-- Dropdown Trigger -->
              <button class="flex items-center px-3 py-1 rounded text-blue-300 hover:bg-gray-800 hover:text-white font-semibold transition">
                <span id="nav-tools-trigger" class="mr-1"></span>
                Tools & Demos
                <span id="nav-tools-chevron" class="ml-1"></span>
              </button>
              
              <!-- Dropdown Menu -->
              <div class="absolute left-0 mt-1 w-56 rounded-md shadow-lg bg-gray-800 ring-1 ring-black ring-opacity-5 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200">
                <div class="py-1" role="menu" aria-orientation="vertical">
                  <a href="checklist.html" class="flex items-center px-4 py-2 text-sm text-blue-200 hover:bg-gray-700 hover:text-white" role="menuitem">
                    <span id="nav-checklist" class="mr-2"></span>Checklist
                  </a>
                  <a href="epssdemo.html" class="flex items-center px-4 py-2 text-sm text-blue-200 hover:bg-gray-700 hover:text-white" role="menuitem">
                    <span id="nav-epss" class="mr-2"></span>CVSS vs EPSS
                  </a>
                  <a href="encryption.html" class="flex items-center px-4 py-2 text-sm text-blue-200 hover:bg-gray-700 hover:text-white" role="menuitem">
                    <span id="nav-encryption" class="mr-2"></span>Encryption
                  </a>
                  <a href="fingerprint.html" class="flex items-center px-4 py-2 text-sm text-blue-200 hover:bg-gray-700 hover:text-white" role="menuitem">
                    <span id="nav-fp" class="mr-2"></span>Fingerprinting
                  </a>
                  <a href="jwt.html" class="flex items-center px-4 py-2 text-sm text-blue-200 hover:bg-gray-700 hover:text-white" role="menuitem">
                    <span id="nav-jwt" class="mr-2"></span>JWT Decoder
                  </a>
                  <a href="modcat.html" class="flex items-center px-4 py-2 text-sm text-blue-200 hover:bg-gray-700 hover:text-white" role="menuitem">
                    <span id="nav-modcat" class="mr-2"></span>PRS MODCAT
                  </a>
                  <a href="shamir.html" class="flex items-center px-4 py-2 text-sm text-blue-200 hover:bg-gray-700 hover:text-white" role="menuitem">
                    <span id="nav-shamir" class="mr-2"></span>Shamir's Visualizer
                  </a>
                  <a href="dashboard.html" class="flex items-center px-4 py-2 text-sm text-blue-200 hover:bg-gray-700 hover:text-white" role="menuitem">
                    <span id="nav-dashboard" class="mr-2"></span>Threat Intel
                  </a>
                  <a href="string.html" class="flex items-center px-4 py-2 text-sm text-blue-200 hover:bg-gray-700 hover:text-white" role="menuitem">
                      <span id="nav-stringart" class="mr-2"></span>String Art
                  </a>
                </div>
              </div>
            </div>
            
          </div>
        </div>
    </nav>

    <div class="min-h-screen p-8 md:p-12 lg:p-16">
        <div class="max-w-4xl mx-auto">
            <header class="text-center mb-12 md:mb-16">
                <h1 class="text-4xl md:text-5xl lg:text-6xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500 mb-4">
                    The Secure SDLC
                </h1>
                <p class="text-lg md:text-xl text-gray-300">
                    An interactive guide to integrating security into the software development lifecycle (DevSecOps).
                </p>
            </header>

            <!-- Main Infographic Flow -->
            <main>
                <div class="relative space-y-12" id="infographic-container">
                    
                    <!-- The vertical timeline bar (decorative) -->
                    <div 
                      class="absolute left-1/2 -translate-x-1/2 w-1 bg-gray-700 h-full hidden md:block"
                      aria-hidden="true"
                    ></div>

                    <!-- 3. Stage cards will be dynamically inserted here by JavaScript -->

                </div>
            </main>
            <footer class="bg-gray-900 text-gray-400 text-center py-4 mt-8 rounded-t-xl shadow-inner">
                Â© 2025 D. Chandler Prince
            </footer>

        </div>
    </div>

    <!-- ADDED: Lucide Icons & Dropdown JS -->
    <script>
        // Render Lucide icons
        lucide.createIcons({
          icons: {
            'github-icon': lucide.Github,
            'linkedin-icon': lucide.Linkedin,
            'certificate-icon': lucide.BadgeCheck,
            'mcp-icon': lucide.Usb,
            'bisopartner-icon': lucide.Puzzle,
            'fingerprint-icon': lucide.Fingerprint,
            'epss-icon': lucide.Activity,
            'jwt-icon': lucide.KeyRound,
            'modcat-icon': lucide.Guitar,
            'threat-icon': lucide.ShieldAlert,
            'checklist-icon': lucide.ListChecks,
            'dashboard-icon': lucide.LayoutDashboard,
            'sast-icon': lucide.FileSearch,
            'cloud-icon': lucide.Cloud,
            'external-link-fp': lucide.ExternalLink,
            'external-link-epss': lucide.ExternalLink,
            'external-link-jwt': lucide.ExternalLink,
            'external-link-modcat': lucide.ExternalLink,
            'external-link-threat': lucide.ExternalLink,
            'external-link-checklist': lucide.ExternalLink,
            'external-link-dashboard': lucide.ExternalLink,
            'external-link-sast': lucide.ExternalLink,
            'external-link-cloud': lucide.ExternalLink,
            
            // --- Nav Icons ---
            'nav-home': lucide.Home,
            'nav-guides-trigger': lucide.BookOpen,
            'nav-tools-trigger': lucide.Briefcase,
            'nav-guides-chevron': lucide.ChevronDown,
            'nav-tools-chevron': lucide.ChevronDown,
            'nav-phishing': lucide.Fish, 
            'nav-cloud': lucide.Cloud,
            'nav-sast': lucide.FileSearch,
            'nav-threat': lucide.ShieldAlert,
            'nav-checklist': lucide.ListChecks,
            'nav-jwt': lucide.KeyRound,
            'nav-encryption': lucide.Lock, 
            'nav-fp': lucide.Fingerprint,
            'nav-epss': lucide.Activity,
            'nav-dashboard': lucide.LayoutDashboard,
            'nav-modcat': lucide.Guitar,
            'nav-roadmap': lucide.Map,
            'nav-shamir': lucide.Share2,
            'nav-regulation': lucide.Gavel,
            'nav-fair': lucide.Banknote,
            'nav-stringart': lucide.GalleryVertical,
            'nav-sdlc': lucide.IterationCcw, // ADDED: Icon for SDLC
            
    
            // --- NEW ICONS for Expandable Cards ---
            'chevron-down-mcp': lucide.ChevronDown,
            'chevron-up-mcp': lucide.ChevronUp,
            'chevron-down-iso': lucide.ChevronDown,
            'chevron-up-iso': lucide.ChevronUp,
            'chevron-down-biso': lucide.ChevronDown,
            'chevron-up-biso': lucide.ChevronUp
          },
          attrs: {
            color: "#38bdf8",
            size: 24,
            strokeWidth: 2
          }
        });
    
        // --- Dropdown Click Handling for Mobile/Touch ---
        const dropdownButtons = document.querySelectorAll('.group > button');
    
        dropdownButtons.forEach(button => {
          button.addEventListener('click', (e) => {
            const dropdownMenu = e.currentTarget.nextElementSibling;
            
            // Close all other open dropdowns
            document.querySelectorAll('.group .absolute').forEach(menu => {
              if (menu !== dropdownMenu) {
                menu.classList.add('opacity-0', 'invisible');
                menu.classList.remove('opacity-100', 'visible');
              }
            });
    
            // Toggle the current dropdown
            dropdownMenu.classList.toggle('opacity-0');
            dropdownMenu.classList.toggle('invisible');
            dropdownMenu.classList.toggle('opacity-100');
            dropdownMenu.classList.toggle('visible');
          });
        });
    
        // Close dropdowns if clicking outside
        window.addEventListener('click', (e) => {
          if (!e.target.closest('.group')) {
            document.querySelectorAll('.group .absolute').forEach(menu => {
              menu.classList.add('opacity-0', 'invisible');
              menu.classList.remove('opacity-100', 'visible');
            });
          }
        });
    </script>

    <!-- 4. JavaScript Logic (for SDLC Infographic) -->
    <script>
        /**
         * Data for the Secure SDLC stages.
         * This now features "concepts" with details for the popovers.
         */
        const sdlcData = [
          {
            id: 1,
            name: '1. Training & Culture',
            description: 'Establishing a security-first mindset. Developers are trained on secure coding practices, common vulnerabilities (like OWASP Top 10), and the specific security goals of the organization.',
            color: 'border-blue-500',
            bgColor: 'bg-blue-500',
            concepts: [
              {
                id: 'c1_1',
                name: 'OWASP Top 10',
                details: 'A critical resource listing the 10 most critical web application security risks. Understanding these is fundamental for all developers.'
              },
              {
                id: 'c1_2',
                name: 'Security Training',
                details: 'Interactive platforms and workshops used to train developers on secure coding practices.<br><br><strong>Examples:</strong><ul><li>Snyk Learn</li><li>Secure Code Warrior</li><li>Company Workshops</li></ul>'
              }
            ]
          },
          {
            id: 2,
            name: '2. Requirements & Design',
            description: 'Proactively planning for security. This involves creating security requirements, abuse cases, and performing threat modeling to identify and mitigate potential design flaws before code is written.',
            color: 'border-indigo-500',
            bgColor: 'bg-indigo-500',
            concepts: [
              {
                id: 'c2_1',
                name: 'Threat Modeling',
                details: 'A structured process to identify, quantify, and address potential security threats in a system\'s design.<br><br><strong>Common Models:</strong><ul><li>STRIDE</li><li>PASTA</li><li>DREAD</li></ul><strong>Tools:</strong><ul><li>OWASP Threat Dragon</li><li>Microsoft Threat Modeling Tool</li></ul>'
              },
              {
                id: 'c2_2',
                name: 'Security Requirements',
                details: 'Defining specific, testable security functional (e.g., "must use 2FA") and non-functional (e.g., "must withstand X requests/sec") requirements.'
              }
            ]
          },
          {
            id: 3,
            name: '3. Code',
            description: 'Writing secure code and catching bugs early. Developers use IDE plugins and pre-commit hooks to get real-time feedback on vulnerabilities and code quality issues as they type.',
            color: 'border-purple-500',
            bgColor: 'bg-purple-500',
            concepts: [
                {
                    id: 'c3_1',
                    name: 'IDE Security Plugins',
                    details: 'Real-time feedback inside your editor. These plugins scan code as you write it to find vulnerabilities before they are even committed.<br><br><strong>Examples:</strong><ul><li>Snyk (IDE Plugin)</li><li>SonarLint</li></ul>'
                },
                {
                    id: 'c3_2',
                    name: 'Linters (Security)',
                    details: 'Automated tools that analyze source code to enforce coding standards. Can be configured with security-specific rules to catch common programming errors that lead to vulnerabilities.<br><br><strong>Examples:</strong><ul><li>ESLint (with security rules)</li><li>Semgrep</li></ul>'
                },
                {
                    id: 'c3_3',
                    name: 'Pre-Commit Hooks',
                    details: 'Automated scripts that run before code is committed. They can be used to scan for hardcoded secrets (API keys, passwords).<br><br><strong>Examples:</strong><ul><li>Git-secrets</li><li>Talisman</li></ul>'
                }
            ]
          },
          {
              id: 4,
              name: '4. Build (CI)',
              description: 'Automating security checks in the CI pipeline. When code is committed, the build server triggers Static Analysis (SAST) and Software Composition Analysis (SCA) to find bugs in the new code and vulnerabilities in third-party libraries.',
              color: 'border-green-500',
              bgColor: 'bg-green-500',
              concepts: [
                  {
                      id: 'c4_1',
                      name: 'Static Analysis (SAST)',
                      details: 'Analyzes the application\'s source code "at rest" during the build process to find in-depth security vulnerabilities, data flow issues, and weaknesses.<br><br><strong>Examples:</strong><ul><li>SonarQube</li><li>Checkmarx</li><li>Snyk Code</li><li>GitHub Advanced Security</li></ul>'
                  },
                  {
                      id: 'c4_2',
                      name: 'Composition Analysis (SCA)',
                      details: 'Scans your project\'s dependencies (e.g., npm, Maven) to find known vulnerabilities (CVEs) in third-party libraries. Also helps manage open-source licenses.<br><br><strong>Examples:</strong><ul><li>OWASP Dependency-Check</li><li>Snyk Open Source</li><li>Dependabot</li></ul>'
                  }
              ]
          },
          {
              id: 5,
              name: '5. Test (QA)',
              description: 'Verifying the running application. This stage involves Dynamic Analysis (DAST) which attacks the application like a hacker would. It also includes container scanning and, in mature orgs, fuzz testing.',
              color: 'border-yellow-500',
              bgColor: 'bg-yellow-500',
              concepts: [
                  {
                      id: 'c5_1',
                      name: 'Dynamic Analysis (DAST)',
                      details: 'Tests the *running* application by sending automated, malicious-looking requests to find vulnerabilities like XSS, SQL Injection, etc. It simulates an external attacker.<br><br><strong>Examples:</strong><ul><li>OWASP ZAP</li><li>Burp Suite (Automated Scan)</li></ul>'
                  },
                  {
                      id: 'c5_2',
                      name: 'Container Scanning',
                      details: 'Analyzes container images (e.g., Docker) to find known vulnerabilities in the base image, operating system packages, and other installed software.<br><br><strong>Examples:</strong><ul><li>Aqua Trivy</li><li>Clair</li><li>Snyk Container</li></ul>'
                  },
                  {
                      id: 'c5_3',
                      name: 'Fuzz Testing',
                      details: 'An advanced testing technique that provides invalid, unexpected, or random data as input to an application to find crashes and security loopholes.'
                  }
              ]
          },
          {
              id: 6,
              name: '6. Deploy (CD)',
              description: 'Securing the release and infrastructure. This includes managing secrets (no hardcoded passwords!), scanning Infrastructure as Code (IaC) templates, and signing artifacts to ensure their integrity.',
              color: 'border-orange-500',
              bgColor: 'bg-orange-500',
              concepts: [
                  {
                      id: 'c6_1',
                      name: 'Secret Management',
                      details: 'Securely storing and managing sensitive information like API keys, database passwords, and certificates, instead of hardcoding them in code.<br><br><strong>Examples:</strong><ul><li>HashiCorp Vault</li><li>AWS Secrets Manager</li><li>Azure Key Vault</li></ul>'
                  },
                  {
                      id: 'c6_2',
                      name: 'IaC Security Scanning',
                      details: 'Analyzes Infrastructure as Code (IaC) templates to find misconfigurations (e.g., public S3 buckets, open security groups) before they are deployed.<br><br><strong>Tools:</strong><ul><li>Checkov</li><li>Tfsec</li></ul><strong>Platforms:</strong><ul><li>Terraform</li><li>Pulumi</li><li>Ansible</li></ul>'
                  },
                  {
                      id: 'c6_3',
                      name: 'Artifact Signing',
                      details: 'Creating a cryptographic signature for a build artifact (like a container image or binary) to prove its integrity and verify its origin. Helps prevent supply chain attacks.<br><br><strong>Tools:</strong><ul><li>Sigstore</li><li>Cosign</li></ul>'
                  }
              ]
          },
          {
              id: 7,
              name: '7. Monitor & Respond',
              description: 'Actively defending the production environment. This involves real-time monitoring, logging, and alerts. Includes Web Application Firewalls (WAF), runtime protection, and SIEMs to respond to threats.',
              color: 'border-red-500',
              bgColor: 'bg-red-500',
              concepts: [
                  {
                      id: 'c7_1',
                      name: 'Runtime Security',
                      details: 'Detects and blocks threats in real-time as they happen in production. This includes container runtime security and application-level protection.<br><br><strong>Examples:</strong><ul><li>Falco</li><li>Sysdig Secure</li></ul>'
                  },
                  {
                      id: 'c7_2',
                      name: 'SIEM & Observability',
                      details: 'Security Information and Event Management (SIEM) tools aggregate logs from all over the infrastructure to find patterns, alert on anomalies, and aid in incident response.<br><br><strong>Examples:</strong><ul><li>Splunk</li><li>Datadog</li><li>Elastic SIEM</li></ul>'
                  },
                  {
                      id: 'c7_3',
                      name: 'Web Application Firewall (WAF)',
                      details: 'A network-level firewall that sits in front of web applications to filter and block malicious HTTP traffic, such as SQL injection and XSS attacks.<br><br><strong>Examples:</strong><ul><li>AWS WAF</li><li>Cloudflare WAF</li><li>NGINX App Protect</li></ul>'
                  },
                  {
                      id: 'c7_4',
                      name: 'Cloud Security (CSPM)',
                      details: 'Cloud Security Posture Management (CSPM) tools continuously monitor cloud environments (AWS, GCP, Azure) for misconfigurations and compliance violations.<br><br><strong>Examples:</strong><ul><li>Prisma Cloud</li><li>Wiz</li></ul>'
                  }
              ]
          },
          {
              id: 8, // This is our new loop card
              name: 'A Continuous Loop',
              description: 'DevSecOps isn\'t a linear process. The "Monitor & Respond" stage provides critical, real-time feedback that informs and improves every other stage, starting a new, more secure cycle. Findings from production are fed back into "Training" and "Requirements" to build a stronger security culture.',
              color: 'border-cyan-500',
              bgColor: 'bg-cyan-500',
              isLoopCard: true, // A flag to render this one differently
              concepts: [] // No concepts for this one
          }
        ];

        // Global variable to track the currently open popover
        let currentPopover = null;

        /**
         * Renders all the SDLC stage cards on page load.
         */
        function renderCards() {
            const container = document.getElementById('infographic-container');
            if (!container) return;

            // Clear any existing content
            container.innerHTML = `
                <div class="absolute left-1/2 -translate-x-1/2 w-1 bg-gray-700 h-full hidden md:block" aria-hidden="true"></div>
            `;

            for (const stage of sdlcData) {
                // Check if it's the special loop card
                if (stage.isLoopCard) {
                    const loopCardHtml = `
                    <div class="bg-gray-800 rounded-xl shadow-2xl overflow-hidden w-full mx-auto relative border-t-4 ${stage.color}">
                        <div class="p-6 text-center">
                            <div class="flex items-center justify-center mb-4">
                                <!-- Loop/Refresh Icon SVG -->
                                <svg class="flex-shrink-0 w-10 h-10 text-cyan-400 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                  <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" />
                                </svg>
                                <h2 class="text-2xl md:text-3xl font-bold text-white">${stage.name}</h2>
                            </div>
                            <p class="text-gray-300 text-base md:text-lg">
                                ${stage.description}
                            </p>
                        </div>
                    </div>
                    `;
                    container.insertAdjacentHTML('beforeend', loopCardHtml);
                } else {
                    // Render the normal card
                    // Create concept buttons HTML
                    const conceptsHtml = stage.concepts.map(concept => `
                        <button 
                            class="concept-button inline-block bg-gray-700 text-gray-200 text-sm font-medium px-3 py-1 rounded-full shadow-sm hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-white transition-colors"
                            data-stage-id="${stage.id}"
                            data-concept-id="${concept.id}"
                        >
                            ${concept.name}
                        </button>
                    `).join('');

                    // Create the full card HTML
                    const cardHtml = `
                        <div class="bg-gray-800 rounded-xl shadow-2xl overflow-hidden w-full mx-auto relative border-t-4 ${stage.color}">
                            <div class="p-6">
                                <div class="flex items-center mb-4">
                                    <span class="flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center text-white font-bold text-lg mr-4 ${stage.bgColor}">
                                        ${stage.id}
                                    </span>
                                    <h2 class="text-2xl md:text-3xl font-bold text-white">${stage.name}</h2>
                                </div>
                                <p class="text-gray-300 mb-6 text-base md:text-lg">
                                    ${stage.description}
                                </p>
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-100 mb-3">Key Concepts:</h3>
                                    <div class="flex flex-wrap gap-2">
                                        ${conceptsHtml}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    // Add the new card to the container
                    container.insertAdjacentHTML('beforeend', cardHtml);
                }
            }
        }

        /**
         * Creates and displays a popover for a clicked concept button.
         */
        function showPopover(button) {
            // Get data from the button's attributes
            const stageId = parseInt(button.dataset.stageId);
            const conceptId = button.dataset.conceptId;

            // Find the corresponding data
            const stage = sdlcData.find(s => s.id === stageId);
            if (!stage) return;
            const concept = stage.concepts.find(c => c.id === conceptId);
            if (!concept) return;

            // Create the popover element
            const popover = document.createElement('div');
            popover.className = 'concept-popover absolute z-10 w-72 p-4 bg-gray-700 text-gray-200 rounded-lg shadow-xl border border-gray-600';
            popover.dataset.popoverId = concept.id; // For tracking
            
            popover.innerHTML = `
                <h4 class="font-bold text-lg mb-2 text-white">${concept.name}</h4>
                <div class="text-sm space-y-2 popover-content">${concept.details}</div>
                <button class="popover-close absolute top-2 right-2 p-1 text-gray-400 hover:text-white" aria-label="Close">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                </button>
            `;

            // Position the popover
            const rect = button.getBoundingClientRect();
            document.body.appendChild(popover);

            // Set initial position
            popover.style.left = `${rect.left + window.scrollX}px`;
            popover.style.top = `${rect.bottom + window.scrollY + 8}px`; // 8px below the button

            // Adjust position if it's off-screen
            const popoverRect = popover.getBoundingClientRect();
            if (popoverRect.right > window.innerWidth - 16) { // 16px padding
                popover.style.left = 'auto';
                popover.style.right = '1rem';
            }
            if (popoverRect.left < 16) {
                popover.style.left = '1rem';
            }

            // Set this as the currently open popover
            currentPopover = popover;

            // Add listener for its close button
            popover.querySelector('.popover-close').addEventListener('click', () => {
                closeCurrentPopover();
            });
        }

        /**
         * Closes the currently open popover, if one exists.
         */
        function closeCurrentPopover() {
            if (currentPopover) {
                currentPopover.remove();
                currentPopover = null;
            }
        }

        // --- Main Event Listener ---
        
        // Listen for clicks on the entire document
        document.addEventListener('click', (event) => {
            const target = event.target;
            
            // Check if the click was on a concept button
            const conceptButton = target.closest('.concept-button');
            // Check if the click was inside the popover
            const isPopoverClick = target.closest('.concept-popover');

            // 1. If click is inside a popover, do nothing
            // This allows selecting text or clicking links inside
            if (isPopoverClick) {
                return;
            }

            // 2. If click is on a concept button
            if (conceptButton) {
                // If a popover is open...
                if (currentPopover) {
                    const popoverId = currentPopover.dataset.popoverId;
                    // ...and it's for a *different* button, close the old one
                    if (popoverId !== conceptButton.dataset.conceptId) {
                        closeCurrentPopover();
                        showPopover(conceptButton); // and show the new one
                    } else {
                        // ...and it's for the *same* button, just close it
                        closeCurrentPopover();
                    }
                } else {
                    // If no popover is open, just show one
                    showPopover(conceptButton);
                }
                return;
            }

            // 3. If click is anywhere else (and not a button or popover)
            // Close any open popover
            closeCurrentPopover();
        });

        // Initial render when the page loads
        document.addEventListener('DOMContentLoaded', renderCards);

    </script>
</body>
</html>